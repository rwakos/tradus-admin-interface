{% extends 'master.html.twig' %}
{% block title %} Welcome to Offers | Tradus workshop {% endblock %}

{% block body %}
<div id="vue-zone">
    <div class="row">
        <div class="col-lg-8 col-md-8 col-xs-8">
            <form class="navbar-form form-search" role="search" method="get" id="form-search" v-on:submit="search()">
                <div class="form-group is-empty w-80">
                    <input type="text" class="form-control w-100" placeholder="Search" v-model="searchText">
                    <span class="material-input"></span>
                </div>
                <button type="submit" class="btn btn-white btn-round btn-just-icon">
                    <i class="material-icons">search</i>
                    <div class="ripple-container"></div>
                </button>
            </form>
        </div>
        <div class="col-lg-4 col-md-4 col-xs-4">
            <h4 class="text-al-right mar-top-10">
                <a href="/offers/create">++ Add New</a>
            </h4>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header" data-background-color="green">
                    <h4 class="title">List of Offers</h4>
                </div>
                <div class="card-content table-responsive">
                    <table class="table">
                        <thead class="text-primary">
                        <th width="65%" colspan="2">Offer Detail's</th>
                        <th>Email</th>
                        <th>Created</th>
                        <th width="5%">
                            <button data-background-color="red" class="btn btn-primary"
                                    v-bind:disabled="Object.keys(checkedValue).length === 0"
                                    v-on:click="deleteSelected()"
                                    style="max-width: 40px !important; padding-left: 12px !important;">
                                <i class="material-icons">delete</i></button>
                        </th>
                        </thead>
                        <tbody>
                        {% verbatim %}
                            <tr v-for="offer in offers">
                                <td width="15%"><a v-bind:href="'/offers/'+offer.id+'/edit'"><img class="img-thumbnail" :src="offer.image" /></a></td>
                                <td><h4 v-text="offer.title"></h4><p v-text="offer.description"></p></td>
                                <td v-text="offer.email"></td>
                                <td v-text="offer.created_at"></td>
                                <td>
                                    <div class="checkbox checkbox-green-light">
                                        <label>
                                            <input type="checkbox" name="optionsCheckboxes" id="chk" v-bind:value="offer.id"
                                                   v-model="checkedValue" checked>
                                        </label>
                                    </div>
                                </td>
                            </tr>
                        {% endverbatim %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('vendor/vue/vue-dev.js') }}"></script>
    <script src="{{ asset('vendor/axios/axios.min.js') }}"></script>

    <script>
        const api_base_path = '{{ twig_api_path }}';
        const api_base_key = '{{ twig_api_key }}';
        var app = new Vue ({
           el: '#vue-zone',

           data: {
               checkedValue: [],
               offers:[],
               searchText:''
           },

           methods:{
               search (){
                    if (this.searchText==''){
                        this.getOffers();
                    } else {
                        const url = api_base_path + "/offers/"+this.searchText;
                        axios.get(url).then(
                            response => this.offers = response.data.data
                        );
                    }
               },
               deleteSelected (){
                   swal({
                       title: "Alert",
                       html: "Are you sure that you want to delete these records?",
                       type: "warning",
                       showCancelButton: true,
                       confirmButtonText: "DELETE",
                       confirmButtonClass: "warning",
                       showLoaderOnConfirm: true,
                       preConfirm: function() {
                           return new Promise(function(resolve) {
                               const url = api_base_path + "/offers/destroy";
                               let data = '{'+this.checkedValue.map((x)=>'"id":'+x).join(",")+'}';
                               axios.delete(url, { data: { ids: data }}).then(
                                   this.getOffers()
                               );
                           });
                       }
                   }).then(function() {

                   });
               },
               getOffers(){
                   const url = api_base_path + "/offers";
                   axios.get(url).then(
                        response => this.offers = response.data.data
                   );
               }
           },
           mounted() {
                this.getOffers();
           }
        });
    </script>

{% endblock %}